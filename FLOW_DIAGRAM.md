# דיאגרמות זרימה - מערכת יצירת סיכומי וידאו חכמה

## זרימה ראשית - תהליך יצירת סיכום

```
┌─────────────────────────────────────────────────────────────────┐
│                         משתמש מעלה וידאו                        │
│                     (MP4, AVI, MOV, MKV עד 4GB)                │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                    הזנת מידע על הסרט                            │
│  • כותרת הסרט/סדרה                                              │
│  • ז'אנר (אקשן, קומדיה, דרמה...)                                │
│  • תיאור מפורט                                                   │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│              הגדרות סיכום והפעלת תכונות מתקדמות                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐  │
│  │ אורך סיכום   │  │ מרווח חיתוך  │  │ תכונות מתקדמות      │  │
│  │ 30s - 3h    │  │ 1s - 60s     │  │ ☑ למידה מיוטיוב     │  │
│  │              │  │              │  │ ☑ חיפוש באינטרנט    │  │
│  └──────────────┘  └──────────────┘  └──────────────────────┘  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
              ┌─────────────┴────────────┐
              │                          │
              ▼                          ▼
    ┌──────────────────┐      ┌─────────────────────┐
    │ למידה מיוטיוב    │      │ חיפוש באינטרנט      │
    │ (אופציונלי)       │      │ (אופציונלי)         │
    └────────┬─────────┘      └──────────┬──────────┘
             │                           │
             ▼                           ▼
    ┌──────────────────┐      ┌─────────────────────┐
    │ • ניתוח ערוץ YT  │      │ • חיפוש מידע על     │
    │ • סגנון עריכה    │      │   הסרט/סדרה         │
    │ • דפוסי מעברים   │      │ • עלילה ורגעים      │
    │ • אורך קטעים    │      │   חשובים            │
    └────────┬─────────┘      └──────────┬──────────┘
             │                           │
             └───────────┬───────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                  עיבוד וידאו עם FFmpeg.wasm                     │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 1. טעינת FFmpeg Engine                                   │  │
│  │ 2. חיתוך קטעים לפי מרווחים מוגדרים                      │  │
│  │ 3. הרכבת קטעים לסיכום אחד                                │  │
│  │ 4. אופטימיזציה וייצוא                                    │  │
│  └──────────────────────────────────────────────────────────┘  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│              יצירת תסריט עם Google Gemini AI                    │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ קלט:                                                      │  │
│  │ • תיאור המשתמש                                           │  │
│  │ • מידע מחיפוש אינטרנט                                    │  │
│  │ • דפוסי סגנון מיוטיוב                                    │  │
│  │ • ז'אנר וקונטקסט                                         │  │
│  │                                                           │  │
│  │ פלט:                                                      │  │
│  │ • תסריט מקצועי בעברית                                    │  │
│  │ • טון קולנועי מותאם לז'אנר                              │  │
│  │ • 3-4 משפטים תמציתיים                                    │  │
│  └──────────────────────────────────────────────────────────┘  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                   שמירה במסד הנתונים                            │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ Supabase Tables:                                          │  │
│  │ • movies_metadata (מידע על הסרט)                         │  │
│  │ • recap_projects (פרטי הפרויקט)                          │  │
│  │ • youtube_learning_sources (דפוסי למידה)                │  │
│  │ • learning_models (משקלים ומדדים)                        │  │
│  └──────────────────────────────────────────────────────────┘  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                         תוצאה למשתמש                            │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────────────┐  │
│  │ 🎬 סיכום    │  │ 📝 תסריט     │  │ 🎙️ קריינות          │  │
│  │   וידאו     │  │   בעברית     │  │   אודיו            │  │
│  │             │  │              │  │                      │  │
│  │ ⬇️ הורדה    │  │ 📋 העתקה    │  │ ▶️ השמעה            │  │
│  └─────────────┘  └──────────────┘  └──────────────────────┘  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                      למידה מתמשכת                               │
│  • שמירת דפוסים מוצלחים                                         │
│  • עדכון משקלי למידה                                            │
│  • שיפור המלצות עתידיות                                         │
└─────────────────────────────────────────────────────────────────┘
```

---

## זרימת למידה מיוטיוב

```
┌────────────────────────────────────────────────┐
│  משתמש מזין Channel ID של YouTube             │
└──────────────────┬─────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────┐
│  קריאה ל-YouTube Data API v3                  │
│  • חיפוש סרטונים בערוץ                        │
│  • מיון לפי צפיות                             │
│  • לקיחת 10 סרטונים מובילים                  │
└──────────────────┬─────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────┐
│  ניתוח כל סרטון                               │
│  ┌──────────────────────────────────────────┐ │
│  │ • זיהוי סגנון עריכה                     │ │
│  │ • חישוב אורך קטע ממוצע                  │ │
│  │ • זיהוי דפוסי מעברים                    │ │
│  │ • ציון פופולריות                        │ │
│  └──────────────────────────────────────────┘ │
└──────────────────┬─────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────┐
│  שמירה ב-youtube_learning_sources             │
│  • channel_id                                  │
│  • video_id                                    │
│  • style_patterns (JSON)                       │
│  • editing_patterns (JSON)                     │
└──────────────────┬─────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────┐
│  שימוש בדפוסים ליצירת התסריט                  │
│  • התאמת קצב העריכה                           │
│  • יישום סגנון מעברים                         │
│  • התאמת אורך קטעים                           │
└────────────────────────────────────────────────┘
```

---

## זרימת חיפוש ושיפור דיוק

```
┌────────────────────────────────────────────────┐
│  משתמש מפעיל "חיפוש באינטרנט"                 │
└──────────────────┬─────────────────────────────┘
                   │
                   ▼
┌────────────────────────────────────────────────┐
│  בדיקת מטמון (web_search_cache)               │
│  • Query: כותרת + ז'אנר                       │
│  • בדיקת תוקף: < 7 ימים                       │
└──────────────────┬─────────────────────────────┘
                   │
         ┌─────────┴─────────┐
         │                   │
         ▼                   ▼
    ┌─────────┐         ┌─────────┐
    │ נמצא    │         │ לא נמצא │
    │ במטמון  │         │ במטמון  │
    └────┬────┘         └────┬────┘
         │                   │
         │                   ▼
         │          ┌─────────────────┐
         │          │ חיפוש באינטרנט  │
         │          │ • עלילה         │
         │          │ • סצינות חשובות │
         │          │ • דמויות        │
         │          └────┬────────────┘
         │               │
         │               ▼
         │          ┌─────────────────┐
         │          │ שמירה במטמון    │
         │          │ (7 ימים)        │
         │          └────┬────────────┘
         │               │
         └───────┬───────┘
                 │
                 ▼
┌────────────────────────────────────────────────┐
│  שימוש במידע ליצירת תסריט משופר                │
│  • הכללת עלילה מדויקת                         │
│  • הדגשת רגעים קריטיים                        │
│  • התייחסות לדמויות ראשיות                    │
└────────────────────────────────────────────────┘
```

---

## זרימת למידה מתמשכת

```
                    ┌──────────────┐
                    │  סיכום נוצר  │
                    └──────┬───────┘
                           │
                           ▼
          ┌────────────────────────────────┐
          │  איסוף נתוני למידה              │
          │  • הגדרות שנבחרו                │
          │  • ז'אנר                        │
          │  • דפוסים שהצליחו               │
          └────────┬───────────────────────┘
                   │
                   ▼
          ┌────────────────────────────────┐
          │  שמירה ב-learning_data          │
          │  (LocalStorage + Supabase)     │
          └────────┬───────────────────────┘
                   │
                   ▼
          ┌────────────────────────────────┐
          │  משתמש מדרג את הסיכום           │
          │  ⭐⭐⭐⭐⭐ (1-5)                  │
          └────────┬───────────────────────┘
                   │
         ┌─────────┴─────────┐
         │                   │
         ▼                   ▼
    ┌─────────┐         ┌─────────┐
    │ דירוג   │         │ דירוג   │
    │ גבוה    │         │ נמוך    │
    │ (4-5)   │         │ (1-3)   │
    └────┬────┘         └────┬────┘
         │                   │
         ▼                   ▼
    ┌─────────┐         ┌─────────┐
    │ שמירת   │         │ ניתוח   │
    │ דפוסים  │         │ כישלון  │
    │ מוצלחים │         │         │
    └────┬────┘         └────┬────┘
         │                   │
         └─────────┬─────────┘
                   │
                   ▼
          ┌────────────────────────────────┐
          │  עדכון משקלי למידה              │
          │  • חישוב ממוצע משוקלל           │
          │  • Exponential Moving Average  │
          │  • עדכון learning_models        │
          └────────┬───────────────────────┘
                   │
                   ▼
          ┌────────────────────────────────┐
          │  המלצות משופרות למשתמשים הבאים  │
          │  • הגדרות אופטימליות לז'אנר    │
          │  • תחזיות איכות                │
          │  • טיפים מותאמים אישית          │
          └────────────────────────────────┘
```

---

## מודל נתונים - Entity Relationship

```
┌─────────────────────┐
│  movies_metadata    │
│─────────────────────│
│ • id (PK)           │
│ • title             │
│ • genre             │
│ • description       │
│ • external_data     │
└──────────┬──────────┘
           │ 1
           │
           │ N
┌──────────┴──────────┐
│  recap_projects     │
│─────────────────────│
│ • id (PK)           │
│ • user_id           │
│ • movie_id (FK)     │
│ • duration_seconds  │
│ • interval_seconds  │
│ • status            │
│ • output_video_url  │
│ • generated_script  │
└──────────┬──────────┘
           │ 1
           │
           │ N
┌──────────┴──────────┐
│  user_feedback      │
│─────────────────────│
│ • id (PK)           │
│ • project_id (FK)   │
│ • rating (1-5)      │
│ • feedback_text     │
└─────────────────────┘


┌─────────────────────────┐
│  youtube_learning_      │
│  sources                │
│─────────────────────────│
│ • id (PK)               │
│ • channel_id            │
│ • video_id (UNIQUE)     │
│ • style_patterns        │
│ • editing_patterns      │
└─────────────────────────┘


┌─────────────────────────┐
│  learning_models        │
│─────────────────────────│
│ • id (PK)               │
│ • model_version (UNIQUE)│
│ • training_data         │
│ • performance_metrics   │
│ • style_weights         │
│ • is_active             │
└─────────────────────────┘


┌─────────────────────────┐
│  web_search_cache       │
│─────────────────────────│
│ • id (PK)               │
│ • query (UNIQUE)        │
│ • search_results        │
│ • expires_at            │
└─────────────────────────┘
```

---

## מצבי סטטוס פרויקט

```
┌──────────┐
│ PENDING  │  ← נוצר אך טרם התחיל עיבוד
└────┬─────┘
     │
     ▼
┌──────────┐
│PROCESSING│  ← בתהליך עיבוד
└────┬─────┘
     │
     ├─────────────────────┐
     │                     │
     ▼                     ▼
┌──────────┐         ┌──────────┐
│COMPLETED │         │ FAILED   │
└──────────┘         └──────────┘
  ← הושלם בהצלחה       ← נכשל (שגיאה)
```

---

## תרחישי שימוש

### תרחיש 1: משתמש חדש
```
1. כניסה לאתר
2. לחיצה על "API Key"
3. הדבקת מפתח Gemini
4. העלאת וידאו ראשון
5. מילוי פרטים בסיסיים
6. יצירת סיכום
7. קבלת המלצות AI
```

### תרחיש 2: משתמש מתקדם
```
1. כניסה עם מפתח שמור
2. העלאת וידאו
3. הפעלת כל התכונות המתקדמות
4. ציון ערוץ YouTube ללמידה
5. יצירת סיכום משופר
6. דירוג ומשוב
7. שיפור אוטומטי למחזור הבא
```

### תרחיש 3: עבודה עם סדרות
```
1. יצירת סיכום לפרק 1
2. שמירת הגדרות
3. שימוש באותן הגדרות לפרקים הבאים
4. המערכת לומדת את הסגנון
5. סיכומים עוקבים משתפרים אוטומטית
```
